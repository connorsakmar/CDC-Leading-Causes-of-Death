---
title: "CDC Leading Causes of Death"
author: "Connor Sakmar"
date: "November 2, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(kableExtra)
library(tidytext)
library(knitr)
library(janitor)
library(lubridate)
library(stringr)
library(fs)
library(formattable)
library(ggplot2)
library(gganimate)
library(leaflet)
library(rgdal)
library(maps)
library(mapproj)
library(fiftystater)
library(sf)
library(tidyverse)
```

```{r, echo = FALSE}





leading_deaths <- read.csv("NCHS_-_Leading_Causes_of_Death__United_States.csv")

  




#First Bar Graph
    myPlot1 <- leading_deaths %>%
      select(Year, Deaths, State, Cause.Name) %>%
    # I will add a filter to make the year an important function in my shiny app
    #  filter(Year == input$x) %>%
      filter(State == "United States", Cause.Name != "All causes") %>%
      ggplot(aes(x = Cause.Name, y = Deaths, fill = Cause.Name)) + geom_bar(stat = "identity") +
      xlab("Year") + ylab("Number of Deaths") + 
      ggtitle("Leading Causes of Death in the United States 1999-2016") +
      theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())
    
    require(scales)
    myPlot1 + scale_y_continuous(labels = comma)
    
#Scatter Plot   
       myPlot2 <- leading_deaths %>%
      filter(State == "United States") %>%
      filter(Cause.Name == input$Cause.Name) %>%
      ggplot(aes(x = Year, y = Deaths)) + geom_point() + geom_smooth()
    
    require(scales)
    myPlot2 + scale_y_continuous(labels = comma)




  
```
```
```{r}


leading_deaths <- read.csv("NCHS_-_Leading_Causes_of_Death__United_States.csv")

leading_deaths <- leading_deaths %>%
filter(Cause.Name != 'All causes')

st_as_sf(fifty_states, coords = c("long", "lat"))

st_as_sf(fifty_states, coords = c("long", "lat")) %>% 
  # convert sets of points to polygons
  group_by(id, piece) %>% 
  summarize(do_union = FALSE) %>%
  st_cast("POLYGON")

# convert fifty_states to an sf data frame
(sf_fifty <- st_as_sf(fifty_states, coords = c("long", "lat")) %>% 
    # convert sets of points to polygons
    group_by(id, piece) %>% 
    summarize(do_union = FALSE) %>%
    st_cast("POLYGON") %>%
    # convert polygons to multipolygons for states with discontinuous regions
    group_by(id) %>%
    summarize())
   
st_crs(sf_fifty) <- 4326
leading_deaths$id <- tolower(leading_deaths$State)

us_states_leading_deaths <- left_join(sf_fifty, leading_deaths)

write_rds(us_states_leading_deaths, "us_states_leading_deaths.rds", compress = "none")


ggplot(data = us_states_leading_deaths) +
  geom_sf(aes(fill = Deaths))
  
```